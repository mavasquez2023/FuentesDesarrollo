<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<application-sql>
	<SqlTablas>
	
		<empresa-usuarios>
			<list>SELECT EERUTEMP, EEDVEMP, RUTUSR, EEALLOFI, EENOM, EEAPEM, EEAPEP FROM ATDTA.AT03F1 WHERE EERUTEMP = ?</list>
			<find>SELECT EERUTEMP, EEDVEMP, RUTUSR, EEALLOFI, EENOM, EEAPEM, EEAPEP 
			      FROM ATDTA.AT03F1 WHERE EERUTEMP = ? AND RUTUSR = ?</find>
		</empresa-usuarios>

		<servicio-usuarios>
			<delete>DELETE FROM ATDTA.ATEUSR WHERE EERUTEMP = ? AND RUTUSR = ?</delete>
			<insert>INSERT INTO ATDTA.ATEUSR (EERUTEMP, RUTUSR, XSRVCD, XRSRHB) VALUES (?, ?, ?, ?)</insert>
			<update>UPDATE ATDTA.ATEUSR SET XRSRHB = ? WHERE EERUTEMP = ? AND RUTUSR = ? AND XSRVCD = ?</update>
			<list>SELECT U.EERUTEMP, U.RUTUSR, U.XSRVCD, U.XRSRHB, S.XSRVNM, S.XSRVDS 
			      FROM ATDTA.ATEUSR U INNER JOIN ATDTA.ATXSRV S ON U.XSRVCD = S.XSRVCD
				  WHERE S.XSCDFC = 'SI' AND S.XSRVHB = 'SI' AND U.XRSRHB = 'SI'
				    AND EERUTEMP = ? RUTUSR = ?</list>
			<listAll>SELECT A.XSRVCD, A.XSRVNM, A.XSRVDS, A.XSRVHB, A.XSCDPR, A.XSCDFC, IFNULL(B.XRSRHB,'') AS XRSRHB
			      FROM ATDTA.ATXSRV A LEFT JOIN ATDTA.ATEUSR B ON A.XSRVCD = B.XSRVCD AND B.EERUTEMP=? AND B.RUTUSR=?
			      WHERE A.XSCDFC = 'SI'</listAll>
			<find>SELECT U.EERUTEMP, U.RUTUSR, U.XSRVCD, U.XRSRHB, S.XSRVNM, S.XSRVDS 
  					FROM ATDTA.ATEUSR U INNER JOIN ATDTA.ATXSRV S ON U.XSRVCD = S.XSRVCD
   					WHERE S.XSCDFC = 'SI' AND S.XSRVHB = 'SI' AND U.XRSRHB = 'SI'
					  AND EERUTEMP = ? AND RUTUSR = ? AND XSRVCD = ?</find>
		</servicio-usuarios>

		<usuarios>
			<empresas>SELECT EERUTEMP, EEDVEMP, RUTUSR, EEALLOFI, EENOM, EEAPEM, EEAPEP 
					FROM ATDTA.AT03F1 WHERE RUTUSR = ?
			</empresas>
			<clave>SELECT  U.EERUTEMP, U.EEDVEMP, U.RUTUSR, U.EEALLOFI, U.EENOM, U.EEAPEM, U.EEAPEP
			       FROM ATDTA.AT30F1 C INNER JOIN ATDTA.AT03F1 U ON C.RUTUSUARIO = U.RUTUSR 
				   WHERE U.EERUTEMP = ? AND U.RUTUSR = ? AND CLAVEPERSONAL = ?</clave>
			<claveServicio>SELECT  U.EERUTEMP, U.EEDVEMP, U.RUTUSR, U.EEALLOFI, U.EENOM, U.EEAPEM, U.EEAPEP
			       FROM ATDTA.AT30F1 C 
				        INNER JOIN ATDTA.AT03F1 U ON C.RUTUSUARIO = U.RUTUSR 
						INNER JOIN ATDTA.ATEUSR E ON U.EERUTEMP = E.EERUTEMP AND C.RUTUSUARIO = E.RUTUSR
						INNER JOIN ATDTA.ATXSRV S ON E.XSRVCD = S.XSRVCD
				   WHERE S.XSRVHB = 'SI' AND E.XRSRHB = 'SI'
				     AND U.EERUTEMP = ? AND U.RUTUSR = ? AND CLAVEPERSONAL = ? AND E.XSRVCD = ? </claveServicio>
		</usuarios>

		<servicios>
			<listas>
				<funciones>SELECT XSRVCD, XSRVNM, XSRVDS, XSRVHB, XSCDPR, XSCDFC FROM ATDTA.ATXSRV WHERE XSCDFC = 'SI'</funciones>
				<lista>SELECT XSRVCD, XSRVNM, XSRVDS, XSRVHB, XSCDPR, XSCDFC FROM ATDTA.ATXSRV </lista>
			</listas>
		</servicios>
		<creditos>
			<consulta>
				<cabecera>
				     SELECT A.OFIPRO, A.CREFOL, AFIRUT, AFIRUTDV, EMPRUT, EMPRUTDV, 
					AFINOM, CMPA, CREOTOFEC, CRELINGLO, CRENOMMON, CRECUOTOT, 
					CASE WHEN CREOTOFEC > 110930
					 THEN IFNULL((SELECT SUM(PRIMA) FROM CRDTA.CRF1860 S WHERE A.OFIPRO = S.OFIPRO AND A.CREFOL = S.CREFOL AND S.CUONUM = 1), 0) + CRECUOMON
					ELSE CRECUOMON END AS CRECUOMON,
					CREIMPMON, CREREAMON, CRENOMACU, CRETAS, CREDEUSIT,
					CREESTPTM, CRETOP, D.COBEST, RUTAVAL1, RUTAVAL1DV, RUTAVAL2, RUTAVAL2DV, 
					(SELECT COUNT(1) FROM RCDTA.CSL210 PP JOIN CMDTA.CM01F1 PB ON PP.CUOOFIPGO = PB.CMBA 
					WHERE PP.XOFIPRO = A.OFIPRO AND PP.XCREFOL= A.CREFOL ) AS CANTCUOTPAG, 
					0 AS ESTULTCUOTA, 
					0 AS PROXIMCUOTA, 
					(SELECT MIN(CUOVENFEC) FROM RCDTA.CSL200 PP
					WHERE PP.XOFIPRO = A.OFIPRO AND PP.XCREFOL= A.CREFOL AND PP.CUOMONABO=0)  AS FECPROXVENC,
					'Si' AS SEGUROCESAN, 
					'Si' AS SEGURODESAH
				FROM CRDTA.CSL1000 A
					LEFT OUTER JOIN CMDTA.CM02F1 B ON A.EMPRUT = B.CMNA
					LEFT OUTER JOIN CRDTA.CRF8020 C ON A.CRELIN = C.CRELIN
					LEFT OUTER JOIN CRDTA.CSF9000 D ON A.CREFOL = D.CREFOL AND A.OFIPRO = D.OFIPRO
				</cabecera>
				<where-titular>
                    WHERE AFIRUT =?
				</where-titular>
				<where-afiliado>
					WHERE RUTAVAL1 =? OR RUTAVAL2=? OR AFIRUT=?
				</where-afiliado>
				<where-aval>
                    WHERE RUTAVAL1 =? OR RUTAVAL2=? OR AFIRUT=?
				</where-aval>
				<where-folio>
                    WHERE a.OFIPRO =? AND a.CREFOL=?
				</where-folio>
				<where-empresa>
					WHERE EMPRUT=? 
				</where-empresa>
			</consulta>
			<pagos>
                 SELECT C.CREOTOFEC, CUONUM, CUOFECPAG, CMCA, CUODOCPAG, CUODOCTIP, CUOCAPPAG, CUOINTPAG, CUOESTPAG, XOFIPRO, XCREFOL, 
				CASE WHEN C.CREOTOFEC > 110930
				 THEN IFNULL((SELECT SUM(MONPAG) FROM CRDTA.CRF0030 P WHERE A.XOFIPRO = P.OFIPRO AND A.XCREFOL = P.CREFOL AND A.CUONUM = P.CUONUM), 0) 
				 ELSE 0 END AS SEGUROS
				FROM RCDTA.CSL210 A, CRDTA.CSL1000 C
				JOIN CMDTA.CM01F1 B ON A.CUOOFIPGO = B.CMBA 
				WHERE XOFIPRO = ? AND XCREFOL = ? AND XOFIPRO = C.OFIPRO AND XCREFOL = C.CREFOL 
			</pagos>
			<cuotas>
                SELECT C.CREOTOFEC, CUONUM, CUOVENFEC, CUOMONCAP, CUOMONINT,
				CASE WHEN C.CREOTOFEC > 110930
				 THEN (IFNULL((SELECT SUM(MONPAG) FROM CRDTA.CRF0030 P WHERE A.XOFIPRO = P.OFIPRO AND A.XCREFOL = P.CREFOL AND A.CUONUM = P.CUONUM), 0) + CUOMONABO) 
				 ELSE CUOMONABO END AS CUOMONABO, 
				CUOEST, XOFIPRO, XCREFOL,
				CASE WHEN C.CREOTOFEC > 110930
				 THEN  (IFNULL((SELECT SUM(PRIMA) FROM CRDTA.CRF1860 S WHERE A.XOFIPRO = S.OFIPRO AND A.XCREFOL = S.CREFOL AND A.CUONUM = S.CUONUM), 0) + CUOMONCAP + CUOMONINT)
				 ELSE (CUOMONCAP + CUOMONINT) END AS MONPAGTOT,
				 IFNULL((SELECT SUM(PRIMA) FROM CRDTA.CRF1860 S WHERE A.XOFIPRO = S.OFIPRO AND A.XCREFOL = S.CREFOL AND A.CUONUM = S.CUONUM), 0) AS SEGMON
				FROM RCDTA.CSL200 A, CRDTA.CSL1000 C
				WHERE XOFIPRO =? AND XCREFOL =? AND XOFIPRO = C.OFIPRO AND XCREFOL = C.CREFOL 
			</cuotas>
			<seguros>
                 SELECT AFIRUT, OFIPRO, CREFOL, PORPOLIZA, MONTOSEG, FECINICOB,
                        ESTADO, SEGCARGO, SEGFECEST, SEGPOLIZA, TIPOSEG
                   FROM CRDTA.CRF1850 
                   WHERE OFIPRO = ? AND CREFOL = ?
			</seguros>
		</creditos>
	</SqlTablas>
</application-sql>
