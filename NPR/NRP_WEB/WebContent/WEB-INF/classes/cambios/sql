CREATE TABLE WF_NOMINAS.DATA_ARCHIVO ( 

	PERIODO VARCHAR(6) CCSID 284 DEFAULT NULL , 

	TIPO_NOMINA FOR COLUMN TIPO_00001 VARCHAR(1) CCSID 284 DEFAULT NULL , 

	OFICINA_PAGO FOR COLUMN OFICI00001 VARCHAR(3) CCSID 284 DEFAULT NULL , 

	NUMERO_CONTRATO FOR COLUMN NUMER00001 VARCHAR(12) CCSID 284 DEFAULT NULL , 

	FECHA_VCTO VARCHAR(8) CCSID 284 DEFAULT NULL , 

	NUMERO_CUOTA FOR COLUMN NUMER00002 VARCHAR(3) CCSID 284 DEFAULT NULL , 

	CANTIDAD_CUOTAS FOR COLUMN CANTI00001 VARCHAR(3) CCSID 284 DEFAULT NULL , 

	IMPORTE_CUOTA_MONEDA_TX FOR COLUMN IMPOR00001 VARCHAR(23) CCSID 284 DEFAULT NULL , 

	IMPORTE_CUOTA_MONEDA_LOCAL FOR COLUMN IMPOR00002 VARCHAR(23) CCSID 284 DEFAULT NULL , 

	IMPORTE_GRAVAMEN_MONEDA_LOCAL FOR COLUMN IMPOR00003 VARCHAR(23) CCSID 284 DEFAULT NULL , 

	CODIGO_MONEDA_LOCAL FOR COLUMN CODIG00001 VARCHAR(5) CCSID 284 DEFAULT NULL , 

	MONEDA_TX VARCHAR(5) CCSID 284 DEFAULT NULL , 

	COTIZACION_MONEDA_TX FOR COLUMN COTIZ00001 VARCHAR(13) CCSID 284 DEFAULT NULL , 

	RUT_PAGADOR FOR COLUMN RUT_P00001 VARCHAR(11) CCSID 284 DEFAULT NULL , 

	RUT_EMPRESA FOR COLUMN RUT_E00001 VARCHAR(11) CCSID 284 DEFAULT NULL , 

	BP_ANEXO_SAP FOR COLUMN BP_AN00001 VARCHAR(10) CCSID 284 DEFAULT NULL , 

	NRO_INSCRIP FOR COLUMN NRO_I00001 VARCHAR(20) CCSID 284 DEFAULT NULL , 

	CAJA_PREVIS FOR COLUMN CAJA_00001 VARCHAR(30) CCSID 284 DEFAULT NULL , 

	GRUPO_PAGO VARCHAR(4) CCSID 284 DEFAULT NULL , 

	NUM_BENEF VARCHAR(4) CCSID 284 DEFAULT NULL , 

	EMPNOMCODP VARCHAR(3) CCSID 284 DEFAULT NULL , 

	SUCUR_CCLA VARCHAR(3) CCSID 284 DEFAULT NULL , 

	PRODUCTO VARCHAR(3) CCSID 284 DEFAULT NULL , 

	CCAF VARCHAR(4) CCSID 284 DEFAULT NULL , 

	CONTREXTE VARCHAR(15) CCSID 284 DEFAULT NULL , 

	IDENTIFIC VARCHAR(1) CCSID 284 DEFAULT NULL , 

	TIPOOPERACION FOR COLUMN TIPOO00001 VARCHAR(3) CCSID 284 DEFAULT NULL , 

	PAGADOR VARCHAR(3) CCSID 284 DEFAULT NULL , 

	N_MESES_MOROSO FOR COLUMN N_MES00001 VARCHAR(3) CCSID 284 DEFAULT NULL , 

	FECHA_DE_COLOCACION FOR COLUMN FECHA00001 VARCHAR(8) CCSID 284 DEFAULT NULL , 

	EMPLANILLADO_SN FOR COLUMN EMPLA00001 VARCHAR(1) CCSID 284 DEFAULT NULL , 

	ORIGEN VARCHAR(30) CCSID 284 DEFAULT NULL , 

	CODIGO_CAJA_ORIGEN FOR COLUMN CODIG00002 VARCHAR(4) CCSID 284 DEFAULT NULL , 

	CODIGO_CAJA_DESTINO FOR COLUMN CODIG00003 VARCHAR(4) CCSID 284 DEFAULT NULL , 

	NUMERO_PAGARE FOR COLUMN NUMER00003 VARCHAR(15) CCSID 284 DEFAULT NULL , 

	IDENT_ENTIDAD_PAG FOR COLUMN IDENT00001 VARCHAR(15) CCSID 284 DEFAULT NULL , 

	IDENT_DEUDOR FOR COLUMN IDENT00002 VARCHAR(15) CCSID 284 DEFAULT NULL , 

	NOMBRE_DEUDOR FOR COLUMN NOMBR00001 VARCHAR(100) CCSID 284 DEFAULT NULL , 

	IDENT_AVAL VARCHAR(15) CCSID 284 DEFAULT NULL , 

	SUJETO_DESCUENTO FOR COLUMN SUJET00001 VARCHAR(1) CCSID 284 DEFAULT NULL , 

	TIPO_IDENTIFICADOR FOR COLUMN TIPO_00002 VARCHAR(2) CCSID 284 DEFAULT NULL , 

	TIPO_AFILIADO FOR COLUMN TIPO_00003 VARCHAR(2) CCSID 284 DEFAULT NULL , 

	TIPO_DEUDA VARCHAR(1) CCSID 284 DEFAULT NULL , 

	MONTO_COBRAR FOR COLUMN MONTO00001 VARCHAR(15) CCSID 284 DEFAULT NULL , 

	MONTO_PAGADO FOR COLUMN MONTO00002 VARCHAR(15) CCSID 284 DEFAULT NULL , 

	FECHA_PAGO VARCHAR(8) CCSID 284 DEFAULT NULL , 

	ESTADO VARCHAR(1) CCSID 284 DEFAULT NULL , 

	RENTA_LIQUIDA FOR COLUMN RENTA00001 VARCHAR(12) CCSID 284 DEFAULT NULL , 

	PORCENTAJE_CARGA_FINANC FOR COLUMN PORCE00001 VARCHAR(2) CCSID 284 DEFAULT NULL , 

	CARGA_MAXIMA FOR COLUMN CARGA00001 VARCHAR(12) CCSID 284 DEFAULT NULL , 

	ID_SERIAL DECIMAL(10, 0) DEFAULT NULL , 

	ID NUMERIC(9, 0) GENERATED ALWAYS AS IDENTITY ( 
	START WITH 1 INCREMENT BY 1 
	NO MINVALUE NO MAXVALUE 
	NO CYCLE NO ORDER 
	CACHE 20 )  , 

	CODIGO_HOLDING FOR COLUMN CODIG00004 VARCHAR(20) CCSID 284 DEFAULT NULL ) ;
	
	
	
	schema: WF_NOMINAS----------------- NRPDTA

tabla: DATA_ARCHIVO-----------------NRP10F1

tabla: DATA_NOMINA-------------------NRP15F1

tabla: CARTAS-----------------------------NRP20F1

tabla: CONFIG_ENVIO-------------------NRP25F1

tabla: CONFIG_NOMINA-----------------NRP30f1

tabla: FORMATOS_NOMINA------------NRP35f1

tabla: PARAMETROS----------------------NRP40f1
tabla: WF_ALERTA------------------------NRP45f1
tabla: WF_MAIL----------------------------NRP50f1

tabla: ORIGENES_DATOS----------------NRP55f1
tabla: SESION_USUARIO-----------------NRP60f1

tabla: ERROR_TABLA_SINACAFF-----NRP65f1



create table TOKEN (
id_usuario varchar(50)  primary key not null,
token varchar(50),
fecha timestamp
);


create table USUARIO (
id_usuario varchar(50) primary key not null,
nombre varchar(50),
super_usuario int default 0,
_password varchar(50)
);
































CREATE TABLE NRPDTA.NRP10F1 ( 

	PERIODO VARCHAR(6)  DEFAULT NULL , 

	TIPO_NOMINA  VARCHAR(1)  DEFAULT NULL , 

	OFICINA_PAGO  VARCHAR(3)  DEFAULT NULL , 

	NUMERO_CONTRATO  VARCHAR(12)  DEFAULT NULL , 

	FECHA_VCTO VARCHAR(8)  DEFAULT NULL , 

	NUMERO_CUOTA  VARCHAR(3)  DEFAULT NULL , 

	CANTIDAD_CUOTAS  VARCHAR(3)  DEFAULT NULL , 

	IMPORTE_CUOTA_MONEDA_TX  VARCHAR(23)  DEFAULT NULL , 

	IMPORTE_CUOTA_MONEDA_LOCAL  VARCHAR(23)  DEFAULT NULL , 

	IMPORTE_GRAVAMEN_MONEDA_LOCAL  VARCHAR(23)  DEFAULT NULL , 

	CODIGO_MONEDA_LOCAL  VARCHAR(5)  DEFAULT NULL , 

	MONEDA_TX VARCHAR(5)  DEFAULT NULL , 

	COTIZACION_MONEDA_TX  VARCHAR(13)  DEFAULT NULL , 

	RUT_PAGADOR  VARCHAR(11)  DEFAULT NULL , 

	RUT_EMPRESA  VARCHAR(11)  DEFAULT NULL , 

	BP_ANEXO_SAP  VARCHAR(10)  DEFAULT NULL , 

	NRO_INSCRIP  VARCHAR(20)  DEFAULT NULL , 

	CAJA_PREVIS  VARCHAR(30)  DEFAULT NULL , 

	GRUPO_PAGO VARCHAR(4)  DEFAULT NULL , 

	NUM_BENEF VARCHAR(4)  DEFAULT NULL , 

	EMPNOMCODP VARCHAR(3)  DEFAULT NULL , 

	SUCUR_CCLA VARCHAR(3)  DEFAULT NULL , 

	PRODUCTO VARCHAR(3)  DEFAULT NULL , 

	CCAF VARCHAR(4)  DEFAULT NULL , 

	CONTREXTE VARCHAR(15)  DEFAULT NULL , 

	IDENTIFIC VARCHAR(1)  DEFAULT NULL , 

	TIPOOPERACION  VARCHAR(3)  DEFAULT NULL , 

	PAGADOR VARCHAR(3)  DEFAULT NULL , 

	N_MESES_MOROSO  VARCHAR(3)  DEFAULT NULL , 

	FECHA_DE_COLOCACION  VARCHAR(8)  DEFAULT NULL , 

	EMPLANILLADO_SN  VARCHAR(1)  DEFAULT NULL , 

	ORIGEN VARCHAR(30)  DEFAULT NULL , 

	CODIGO_CAJA_ORIGEN  VARCHAR(4)  DEFAULT NULL , 

	CODIGO_CAJA_DESTINO  VARCHAR(4)  DEFAULT NULL , 

	NUMERO_PAGARE  VARCHAR(15)  DEFAULT NULL , 

	IDENT_ENTIDAD_PAG  VARCHAR(15)  DEFAULT NULL , 

	IDENT_DEUDOR  VARCHAR(15)  DEFAULT NULL , 

	NOMBRE_DEUDOR  VARCHAR(100)  DEFAULT NULL , 

	IDENT_AVAL VARCHAR(15)  DEFAULT NULL , 

	SUJETO_DESCUENTO  VARCHAR(1)  DEFAULT NULL , 

	TIPO_IDENTIFICADOR  VARCHAR(2)  DEFAULT NULL , 

	TIPO_AFILIADO  VARCHAR(2)  DEFAULT NULL , 

	TIPO_DEUDA VARCHAR(1)  DEFAULT NULL , 

	MONTO_COBRAR  VARCHAR(15)  DEFAULT NULL , 

	MONTO_PAGADO  VARCHAR(15)  DEFAULT NULL , 

	FECHA_PAGO VARCHAR(8)  DEFAULT NULL , 

	ESTADO VARCHAR(1)  DEFAULT NULL , 

	RENTA_LIQUIDA  VARCHAR(12)  DEFAULT NULL , 

	PORCENTAJE_CARGA_FINANC  VARCHAR(2)  DEFAULT NULL , 

	CARGA_MAXIMA  VARCHAR(12)  DEFAULT NULL , 

	ID_SERIAL DECIMAL(10, 0) DEFAULT NULL , 

	ID NUMERIC(9, 0) GENERATED ALWAYS AS IDENTITY ( 
	START WITH 1 INCREMENT BY 1 
	NO MINVALUE NO MAXVALUE 
	NO CYCLE NO ORDER 
	CACHE 20 )  , 

	CODIGO_HOLDING  VARCHAR(20)  DEFAULT NULL ) ;
	
	
	
	
	
insert into nrpdta.nrp40f1 values ('ENVIO_SAP_COMANDO','FTP;146.83.1.39;adminftp;AdminFTP;21;/BQM400/NOConsol/');
insert into nrpdta.nrp40f1 values ('ENVIO_SAP_ARCHIVO','FILE;NRPsys.year4sys.month2_A_SAP_PP.txt');
	
	
	
	
	
create table NRPDTA.NRP80F1 (
RUT     DECIMAL(8,0) DEFAULT NULL,
DV_RUT  VARCHAR(1) CCSID 284 DEFAULT NULL,
INST    VARCHAR(2) CCSID 284 DEFAULT NULL,
NRO_INS VARCHAR(13) CCSID 284 DEFAULT NULL,
DV_NUM_INS VARCHAR(1) CCSID 284 DEFAULT NULL,
COD_GP VARCHAR(1) CCSID 284 DEFAULT NULL,
COD_NB VARCHAR(1) CCSID 284 DEFAULT NULL,
COD_TP VARCHAR(2) CCSID 284 DEFAULT NULL,
NOMBRE VARCHAR(40) CCSID 284 DEFAULT NULL
);


create view NRPDTA.NRP8085V1 as (
select * from nrpdta.nrp80f1
union
select * from nrpdta.nrp85f1
)



select * from nrpdta.nrp55f1

alter table nrpdta.nrp55f1 add column PRE_EJECUCION varchar(256)

update nrpdta.nrp55f1
set 
PRE_EJECUCION = 'java_reflection;cl.jfactory.planillas.service.helper.IPSHelperPBS;limpiarTabla'
WHERE CODIGO = 'IPS_PBS'


update nrpdta.nrp55f1
set 
PRE_EJECUCION = 'java_reflection;cl.jfactory.planillas.service.helper.IPSHelperBP;limpiarTabla'
WHERE CODIGO = 'IPS_BP'

update nrpdta.nrp55f1
set 
PRE_EJECUCION = 'java_reflection;cl.jfactory.planillas.service.helper.WorkFlowHelper;limpiarTablaMagallanes'
WHERE CODIGO = 'MAG'




















*************


insert into nrpdta.nrp30f1 
values ('61607900','','JAVA','cl.liv.nrp.nominas.metodos.java.NominaMagallanes;obtenerInfo1030','txt','MAG_061607900_var.sys.YearMonth;_0130','NOM_61607900_MAG','CONF_61607900_MAG_1030','NSSMAG_1030','',''	)


insert into nrpdta.nrp30f1 
values ('61607900','','JAVA','cl.liv.nrp.nominas.metodos.java.NominaMagallanes;obtenerInfo3030','txt','MAG_061607900_var.sys.YearMonth;_3030','NOM_61607900_MAG','CONF_61607900_MAG_3030','NSSMAG_3030','',''	)







/*
Empresas en nrp15f1 que no quedaron en la tabla de comandos
select distinct ( rut_empresa ) from nrpdta.nrp15f1
where codigo_holding is null
and cast(rut_empresa as varchar(12) ) not in ( select cast( entidad as varchar(12) ) from nrpdta.cmd_201907 )
*/



/*
Holding que no quedaron en la tabla de comandos
select 
        distinct ( d.codigo_holding ) 
from 
        nrpdta.nrp15f1 d,
        nrpdta.nrp30f1 cfg
where d.codigo_holding is not null
      and d.codigo_holding = cfg.codigo_holding
and cast(d.codigo_holding as varchar(12) ) not in ( select cast( entidad as varchar(12) ) from NRPDTA.CMD_$PERIODO$ )

*/



/*

Empresas que pertenecen a holdings, pero que no tienen config nomina especiales y no quedaron registradas en la tabla de comandos
select 
        distinct ( d.rut_empresa ) 
from 
        nrpdta.nrp15f1 d
where d.codigo_holding is not null
and d.codigo_holding not in ( select codigo_holding from nrpdta.nrp30f1 )
and cast(d.codigo_holding as varchar(12) ) not in ( select cast( entidad as varchar(12) ) from nrpdta.cmd_201907 )

*/

