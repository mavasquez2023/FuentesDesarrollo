<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//iBATIS.com//DTD SQL Map Config 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap> 
   	
   	<resultMap id="result_LM" class="cl.laaraucana.silmsil.vo.LM_GlosaErrores_VO" >
		<result property="operador" column="OPERADOR"/>
		<result property="tipoform" column="TIPOFORM"/>
		<result property="folio" column="FOLIO"/>
		<result property="art77bis" column="ART77BIS"/>
		<result property="fecinform" column="FECINFORM"/>
		<result property="ruttrabaj" column="RUTTRABAJ"/>
		<result property="fecemision" column="FECEMISION"/>
		<result property="fecinirepo" column="FECINIREPO"/>
		<result property="fecterrepo" column="FECTERREPO"/>
		<result property="edadtrabaj" column="EDADTRABAJ"/>
		
		<result property="fecnactrab" column="FECNACTRAB"/>
		<result property="gentrabaj" column="GENTRABAJ"/>
		<result property="numdiaslic" column="NUMDIASLIC"/>
		<result property="licmatsupl" column="LICMATSUPL"/>
		<result property="fecnachijo" column="FECNACHIJO"/>
		<result property="ruthijo" column="RUTHIJO"/>
		<result property="tipolic" column="TIPOLIC"/>
		<result property="recuplabor" column="RECUPLABOR"/>
		<result property="iniinvalid" column="INIINVALID"/>
		<result property="fecconcep" column="FECCONCEP"/>
		
		<result property="tiporeposo" column="TIPOREPOSO"/>
		<result property="jorreposo" column="JORREPOSO"/>
		<result property="lugreposo" column="LUGREPOSO"/>
		<result property="especialid" column="ESPECIALID"/>
		<result property="tipoprofes" column="TIPOPROFES"/>
		<result property="rutprofes" column="RUTPROFES"/>
		<result property="nomprofes" column="NOMPROFES"/>
		<result property="licmodific" column="LICMODIFIC"/>
		<result property="entautoriz" column="ENTAUTORIZ"/>
		<result property="tipolmresu" column="TIPOLMRESU"/>
		
		<result property="ndiasincap" column="NDIASINCAP"/>
		<result property="diagresuel" column="DIAGRESUEL"/>
		<result property="periodo" column="PERIODO"/>
		<result property="ndiasprev" column="NDIASPREV"/>
		<result property="estadoreso" column="ESTADORESO"/>
		<result property="tiporesolu" column="TIPORESOLU"/>
		<result property="redictamen" column="REDICTAMEN"/>
		<result property="causarecha" column="CAUSARECHA"/>
		<result property="tiporepoau" column="TIPOREPOAU"/>
		<result property="jorrepoaut" column="JORREPOAUT"/>
		
		<result property="desubsidio" column="DESUBSIDIO"/>
		<result property="fecreceent" column="FECRECEENT"/>
		<result property="fecresoent" column="FECRESOENT"/>
		<result property="rutcontral" column="RUTCONTRAL"/>
		<result property="rutemplead" column="RUTEMPLEAD"/>
		<result property="fecreceemp" column="FECRECEEMP"/>
		<result property="regionempl" column="REGIONEMPL"/>
		<result property="comunaempl" column="COMUNAEMPL"/>
		<result property="actlabtrab" column="ACTLABTRAB"/>
		<result property="ocupactrab" column="OCUPACTRAB"/>
		
		<result property="fecrecepag" column="FECRECEPAG"/>
		<result property="tipregprev" column="TIPREGPREV"/>
		<result property="calitrabaj" column="CALITRABAJ"/>
		<result property="tipoentpag" column="TIPOENTPAG"/>
		<result property="fecpriafil" column="FECPRIAFIL"/>
		<result property="feccontrab" column="FECCONTRAB"/>
		
		<result property="correlativ" column="CORRELATIV"/>
		<result property="correlab" column="CORRELAB"/>
		<result property="fecproceso" column="FECPROCESO"/>
		<result property="descripcion" column="DESCRI"/>
		<result property="idcampo" column="NROCMPO"/>	
	</resultMap>
	
	<resultMap id="result_LM_T" class="cl.laaraucana.silmsil.vo.LM_GlosaErrores_VO" >
		<result property="operador" column="OPERADOR"/>
		<result property="tipoform" column="TIPOFORM"/>
		<result property="folio" column="FOLIO"/>
		<result property="art77bis" column="ART77BIS"/>
		<result property="fecinform" column="FECINFORM"/>
		<result property="ruttrabaj" column="RUTTRABAJ"/>
		<result property="fecemision" column="FECEMISION"/>
		<result property="fecinirepo" column="FECINIREPO"/>
		<result property="fecterrepo" column="FECTERREPO"/>
		<result property="edadtrabaj" column="EDADTRABAJ"/>
		
		<result property="fecnactrab" column="FECNACTRAB"/>
		<result property="gentrabaj" column="GENTRABAJ"/>
		<result property="numdiaslic" column="NUMDIASLIC"/>
		<result property="licmatsupl" column="LICMATSUPL"/>
		<result property="fecnachijo" column="FECNACHIJO"/>
		<result property="ruthijo" column="RUTHIJO"/>
		<result property="tipolic" column="TIPOLIC"/>
		<result property="recuplabor" column="RECUPLABOR"/>
		<result property="iniinvalid" column="INIINVALID"/>
		<result property="fecconcep" column="FECCONCEP"/>
		
		<result property="tiporeposo" column="TIPOREPOSO"/>
		<result property="jorreposo" column="JORREPOSO"/>
		<result property="lugreposo" column="LUGREPOSO"/>
		<result property="especialid" column="ESPECIALID"/>
		<result property="tipoprofes" column="TIPOPROFES"/>
		<result property="rutprofes" column="RUTPROFES"/>
		<result property="nomprofes" column="NOMPROFES"/>
		<result property="licmodific" column="LICMODIFIC"/>
		<result property="entautoriz" column="ENTAUTORIZ"/>
		<result property="tipolmresu" column="TIPOLMRESU"/>
		
		<result property="ndiasincap" column="NDIASINCAP"/>
		<result property="diagresuel" column="DIAGRESUEL"/>
		<result property="periodo" column="PERIODO"/>
		<result property="ndiasprev" column="NDIASPREV"/>
		<result property="estadoreso" column="ESTADORESO"/>
		<result property="tiporesolu" column="TIPORESOLU"/>
		<result property="redictamen" column="REDICTAMEN"/>
		<result property="causarecha" column="CAUSARECHA"/>
		<result property="tiporepoau" column="TIPOREPOAU"/>
		<result property="jorrepoaut" column="JORREPOAUT"/>
		
		<result property="desubsidio" column="DESUBSIDIO"/>
		<result property="fecreceent" column="FECRECEENT"/>
		<result property="fecresoent" column="FECRESOENT"/>
		<result property="rutcontral" column="RUTCONTRAL"/>
		<result property="rutemplead" column="RUTEMPLEAD"/>
		<result property="fecreceemp" column="FECRECEEMP"/>
		<result property="regionempl" column="REGIONEMPL"/>
		<result property="comunaempl" column="COMUNAEMPL"/>
		<result property="actlabtrab" column="ACTLABTRAB"/>
		<result property="ocupactrab" column="OCUPACTRAB"/>
		
		<result property="fecrecepag" column="FECRECEPAG"/>
		<result property="tipregprev" column="TIPREGPREV"/>
		<result property="calitrabaj" column="CALITRABAJ"/>
		<result property="tipoentpag" column="TIPOENTPAG"/>
		<result property="fecpriafil" column="FECPRIAFIL"/>
		<result property="feccontrab" column="FECCONTRAB"/>
		
		<result property="correlativ" column="CORRELATIV"/>
		<result property="fecproceso" column="FECPROCESO"/>
		<result property="descripcion" column="DESCRI"/>
		<result property="idcampo" column="NROCMPO"/>
	</resultMap>
	
	<resultMap id="result_Count_LogAgLM" class="cl.laaraucana.silmsil.vo.CountVO">
		<result property="resultadoCount" column="TOTAL" />
    </resultMap>
	
<!--START: visualizacion de datos sin agrupar. -->	
	<!-- Conseguir el primer set de datos a mostrar -->	
	<select id="getListaErrorLM" resultMap="result_LM">
			SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV,
				B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, B.CORRELATIV AS CORRELAB 
			FROM LIEXP.ILFLM050 AS A
			INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
			AND B.TIPOBS='1'
			ORDER BY CORRELAB ASC
		FETCH FIRST $registrosPorPagina$ ROWS ONLY
	</select>
				
	<!-- Conseguir set siguiente de datos a mostrar -->
	<select id="getPaginaLogLM_FW" resultMap="result_LM">
		SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
			A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
			A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
			TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
			TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
			A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
			TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
			A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS TIPOENTPAG,
			A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV,
			B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, B.CORRELATIV AS CORRELAB 
		FROM LIEXP.ILFLM050 AS A
		INNER JOIN LIEXP.ILFLM054 AS B
			ON A.FECPROCESO=B.PERPAG
			AND A.FOLIO = B.NROFOL
			AND A.RUTTRABAJ=B.RUTTRAB
			AND A.FECTERREPO=B.LICHASFEC
		WHERE A.FECPROCESO=$fecha$ 
		AND B.CORRELATIV &gt; $ultimoLista$
		AND B.TIPOBS='1'
		ORDER BY B.CORRELATIV ASC
		FETCH FIRST $registrosPorPagina$ ROWS ONLY
	</select>
	
	<!-- Conseguir set anterior de datos a mostrar -->
	<select id="getPaginaLogLM_BK" resultMap="result_LM">
		SELECT C.* FROM (
			SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV, B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, 
				B.CORRELATIV AS CORRELAB 
			FROM LIEXP.ILFLM050 AS A
			INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$ 
			AND B.CORRELATIV &lt; $primeroLista$
			AND B.TIPOBS='1'
			ORDER BY B.CORRELATIV DESC
		FETCH FIRST $registrosPorPagina$ ROWS ONLY
		) AS C
		ORDER BY C.CORRELAB
	</select>
	
	<select id="getUltimaPagErrorLM" resultMap="result_LM">
		SELECT * FROM (
			SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV,
				B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, B.CORRELATIV AS CORRELAB 
			FROM LIEXP.ILFLM050 AS A
			INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
			AND B.TIPOBS='1'
			ORDER BY CORRELAB DESC
		FETCH FIRST $registrosPorPagina$ ROWS ONLY
		)AS C ORDER BY CORRELAB ASC
	</select>
	
<!--END:  visualizacion de datos sin agrupar. -->

<!--START:  contar registros-->
	<resultMap id="result_Count_LM" class="cl.laaraucana.silmsil.vo.CountVO">
		<result property="resultadoCount" column="total" />
    </resultMap>
    
	<!-- Obtiene el total de datos a paginar para Log LM  NO agrupados -->
	<select id="getCount_LogLM" resultMap="result_Count_LM">
		SELECT COUNT(*)AS TOTAL 
		FROM LIEXP.ILFLM050 AS A
		INNER JOIN LIEXP.ILFLM054 AS B
			ON A.FECPROCESO=B.PERPAG
			AND TRIM(A.FOLIO) = TRIM(B.NROFOL)
			AND TRIM(A.RUTTRABAJ)=B.RUTTRAB
			AND A.FECTERREPO=B.LICHASFEC
		WHERE A.FECPROCESO=$fecha$
		AND B.TIPOBS='1'
	</select>
	<!--END:  contar registros-->	

	<select id="getErrorLM" resultMap="result_LM_T">
		SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS 						TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV, B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, 
				B.CORRELATIV AS CORRELAB 
		FROM LIEXP.ILFLM050 AS A
		INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
		WHERE A.FECPROCESO=#fecproceso#
				AND B.TIPOBS='1'
				AND TRIM(A.FOLIO)=#folio#
				AND TRIM(A.RUTTRABAJ)=#ruttrabaj#
				AND A.FECTERREPO = #fecterrepo#
	</select>
	
	<select id="getErrorLM_T" resultMap="result_LM_T">
		SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS 						TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV, B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, 
				B.CORRELATIV AS CORRELAB 
		FROM LIEXP.ILFLM050T AS A
		INNER JOIN LIEXP.ILFLM054T AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
		WHERE A.FECPROCESO=#fecproceso#
			AND B.TIPOBS='1'
			AND TRIM(A.FOLIO)=#folio#
			AND TRIM(A.RUTTRABAJ)=#ruttrabaj#
			AND A.FECTERREPO = #fecterrepo#
	</select>
	
	<select id="getErrorLM_porCampo" resultMap="result_LM_T">
		SELECT * FROM LIEXP.ILFLM050 AS A
			INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
		<dynamic prepend="WHERE">
			<isNotNull prepend="AND" property="fecproceso">
				A.FECPROCESO=#fecproceso#
			</isNotNull>
			<isNotNull prepend="AND" property="ruttrabaj">
				TRIM(A.RUTTRABAJ)=#ruttrabaj#
			</isNotNull>
			<isNotNull prepend="AND" property="folio">
				TRIM(A.FOLIO)=#folio#
			</isNotNull>
			<isNotNull prepend="AND" property="correlativ">
				TRIM(B.CORRELATIV)=#correlativ#
			</isNotNull>			
		</dynamic>
		ORDER BY B.NROFOL
	</select>	
	<!--END:  visualizacion de errores para un solo registro-->		

	<!--START: busqueda LM dinamica por folio o rut. SIN AGRUPAR.-->		
	<select id="getBuscarLog_LM" resultMap="result_LM">
		SELECT A.OPERADOR,A.TIPOFORM,TRIM(A.FOLIO) AS FOLIO,A.ART77BIS,A.FECINFORM,TRIM(A.RUTTRABAJ) AS RUTTRABAJ,
				A.FECEMISION,A.FECINIREPO,A.FECTERREPO,A.EDADTRABAJ,A.FECNACTRAB,A.GENTRABAJ,A.NUMDIASLIC,A.LICMATSUPL,
				A.FECNACHIJO,TRIM(A.RUTHIJO) AS RUTHIJO,A.TIPOLIC,A.RECUPLABOR,A.INIINVALID,A.FECCONCEP,A.TIPOREPOSO,
				TRIM(A.JORREPOSO) AS JORREPOSO,A.LUGREPOSO,TRIM(A.ESPECIALID) AS ESPECIALID,A.TIPOPROFES,TRIM(A.RUTPROFES) AS RUTPROFES,
				TRIM(A.NOMPROFES) AS NOMPROFES,A.LICMODIFIC,A.ENTAUTORIZ,A.TIPOLMRESU,A.NDIASINCAP,TRIM(A.DIAGRESUEL) AS DIAGRESUEL,
				A.PERIODO,A.NDIASPREV,A.ESTADORESO,A.TIPORESOLU,A.REDICTAMEN,A.CAUSARECHA,A.TIPOREPOAU,TRIM(A.JORREPOAUT) AS JORREPOAUT,
				TRIM(A.DESUBSIDIO) AS DESUBSIDIO,A.FECRECEENT,A.FECRESOENT,TRIM(A.RUTCONTRAL) AS RUTCONTRAL,TRIM(A.RUTEMPLEAD) AS RUTEMPLEAD,
				A.FECRECEEMP,A.REGIONEMPL,A.COMUNAEMPL,A.ACTLABTRAB,A.OCUPACTRAB,A.FECRECEPAG,A.TIPREGPREV,A.CALITRABAJ,TRIM(A.TIPOENTPAG) AS TIPOENTPAG,
				A.FECPRIAFIL,A.FECCONTRAB,A.FECPROCESO,A.CORRELATIV,
				B.NOMARCH, B.NROCMPO, B.CMPREF, B.DESCRI, B.TIPOBS, B.CORRELATIV AS CORRELAB 
			FROM LIEXP.ILFLM050 AS A
			INNER JOIN LIEXP.ILFLM054 AS B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO = B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
				
		<dynamic prepend="WHERE">
			<isNull prepend="AND" property="tipoobs">
				B.TIPOBS='1'
			</isNull>			
			<isNotNull prepend="AND" property="fecproceso">
				 A.FECPROCESO=#fecproceso#
			</isNotNull>
			<isNotNull prepend="AND" property="folio">
				UPPER(TRIM(A.FOLIO)) like '%$folio$%'
			</isNotNull>
			<isNotNull prepend="AND" property="ruttrabaj">
				UPPER(TRIM(A.RUTTRABAJ)) like '%$ruttrabaj$%'
			</isNotNull>
			fetch FIRST $paginacion$ ROWS ONLY
		</dynamic>
	</select>
	<!--END: busqueda LM dinamica por folio o rut. SIN AGRUPAR.-->	

	<!-- Conteo de páginas para proceso SIL agrupado por número de folio -->
	<select id="getConteoAgrupadoLM" resultMap="result_Count_LogAgLM">	
		SELECT COUNT(*)AS TOTAL FROM (
			SELECT A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
				FROM LIEXP.ILFLM050 A
			INNER JOIN LIEXP.ILFLM054 B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO=B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
				AND B.TIPOBS='1'
			GROUP BY A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
		ORDER BY A.FOLIO) AS C
	</select>


	<!-- Consulta SQL para agrupar datos Log Error -->
	<select id="getDatosAgrupadosLogLM" resultMap="result_LM">
		SELECT C.OPERADOR,C.TIPOFORM,TRIM(C.FOLIO) AS FOLIO,C.ART77BIS,C.FECINFORM,TRIM(C.RUTTRABAJ) AS RUTTRABAJ,
			C.FECEMISION,C.FECINIREPO,C.FECTERREPO,C.EDADTRABAJ,C.FECNACTRAB,C.GENTRABAJ,C.NUMDIASLIC,C.LICMATSUPL,
			C.FECNACHIJO,TRIM(C.RUTHIJO) AS RUTHIJO,C.TIPOLIC,C.RECUPLABOR,C.INIINVALID,C.FECCONCEP,C.TIPOREPOSO,
			TRIM(C.JORREPOSO) AS JORREPOSO,C.LUGREPOSO,TRIM(C.ESPECIALID) AS ESPECIALID,C.TIPOPROFES,TRIM(C.RUTPROFES) AS RUTPROFES,
			TRIM(C.NOMPROFES) AS NOMPROFES,C.LICMODIFIC,C.ENTAUTORIZ,C.TIPOLMRESU,C.NDIASINCAP,TRIM(C.DIAGRESUEL) AS DIAGRESUEL,
			C.PERIODO,C.NDIASPREV,C.ESTADORESO,C.TIPORESOLU,C.REDICTAMEN,C.CAUSARECHA,C.TIPOREPOAU,TRIM(C.JORREPOAUT) AS JORREPOAUT,
			TRIM(C.DESUBSIDIO) AS DESUBSIDIO,C.FECRECEENT,C.FECRESOENT,TRIM(C.RUTCONTRAL) AS RUTCONTRAL,TRIM(C.RUTEMPLEAD) AS RUTEMPLEAD,
			C.FECRECEEMP,C.REGIONEMPL,C.COMUNAEMPL,C.ACTLABTRAB,C.OCUPACTRAB,C.FECRECEPAG,C.TIPREGPREV,C.CALITRABAJ,TRIM(C.TIPOENTPAG) AS TIPOENTPAG,
			C.FECPRIAFIL,C.FECCONTRAB,C.FECPROCESO,C.CORRELATIV,
			D.NOMARCH, D.NROCMPO, D.CMPREF, D.DESCRI, D.TIPOBS, D.CORRELATIV AS CORRELAB, D.LICHASFEC
		FROM  (
			SELECT B.* FROM LIEXP.ILFJAAUX A
			INNER JOIN LIEXP.ILFLM050 B
			ON A.PERPAG=B.FECPROCESO
			AND A.NROFOL=B.FOLIO
			AND A.RUTTRABAJ=B.RUTTRABAJ
			AND A.LICHASFEC=B.FECTERREPO
		) C
		INNER JOIN (
			SELECT B.* FROM LIEXP.ILFJAAUX A
			INNER JOIN LIEXP.ILFLM054 B
			ON A.PERPAG=B.PERPAG
			AND A.NROFOL=B.NROFOL
			AND A.RUTTRABAJ=B.RUTTRAB
			AND A.LICHASFEC=B.LICHASFEC
		) D
			ON C.FECPROCESO=D.PERPAG
			AND C.FOLIO=D.NROFOL
			AND C.RUTTRABAJ=D.RUTTRAB
			AND C.FECTERREPO=D.LICHASFEC
			WHERE C.FECPROCESO=$fecha$
			AND D.TIPOBS='1'
			ORDER BY C.FOLIO
	</select>
	
	<select id="getDatosAgrupadosLogUltimaLM" resultMap="result_LM">
	SELECT * FROM (
		SELECT C.OPERADOR,C.TIPOFORM,TRIM(C.FOLIO) AS FOLIO,C.ART77BIS,C.FECINFORM,TRIM(C.RUTTRABAJ) AS RUTTRABAJ,
			C.FECEMISION,C.FECINIREPO,C.FECTERREPO,C.EDADTRABAJ,C.FECNACTRAB,C.GENTRABAJ,C.NUMDIASLIC,C.LICMATSUPL,
			C.FECNACHIJO,TRIM(C.RUTHIJO) AS RUTHIJO,C.TIPOLIC,C.RECUPLABOR,C.INIINVALID,C.FECCONCEP,C.TIPOREPOSO,
			TRIM(C.JORREPOSO) AS JORREPOSO,C.LUGREPOSO,TRIM(C.ESPECIALID) AS ESPECIALID,C.TIPOPROFES,TRIM(C.RUTPROFES) AS RUTPROFES,
			TRIM(C.NOMPROFES) AS NOMPROFES,C.LICMODIFIC,C.ENTAUTORIZ,C.TIPOLMRESU,C.NDIASINCAP,TRIM(C.DIAGRESUEL) AS DIAGRESUEL,
			C.PERIODO,C.NDIASPREV,C.ESTADORESO,C.TIPORESOLU,C.REDICTAMEN,C.CAUSARECHA,C.TIPOREPOAU,TRIM(C.JORREPOAUT) AS JORREPOAUT,
			TRIM(C.DESUBSIDIO) AS DESUBSIDIO,C.FECRECEENT,C.FECRESOENT,TRIM(C.RUTCONTRAL) AS RUTCONTRAL,TRIM(C.RUTEMPLEAD) AS RUTEMPLEAD,
			C.FECRECEEMP,C.REGIONEMPL,C.COMUNAEMPL,C.ACTLABTRAB,C.OCUPACTRAB,C.FECRECEPAG,C.TIPREGPREV,C.CALITRABAJ,TRIM(C.TIPOENTPAG) AS TIPOENTPAG,
			C.FECPRIAFIL,C.FECCONTRAB,C.FECPROCESO,C.CORRELATIV,
			D.NOMARCH, D.NROCMPO, D.CMPREF, D.DESCRI, D.TIPOBS, D.CORRELATIV AS CORRELAB, D.LICHASFEC
		FROM  (
			SELECT B.* FROM LIEXP.ILFJAAUX A
			INNER JOIN LIEXP.ILFLM050 B
			ON A.PERPAG=B.FECPROCESO
			AND A.NROFOL=B.FOLIO
			AND A.RUTTRABAJ=B.RUTTRABAJ
			AND A.LICHASFEC=B.FECTERREPO
		) C
		INNER JOIN (
			SELECT B.* FROM LIEXP.ILFJAAUX A
			INNER JOIN LIEXP.ILFLM054 B
			ON A.PERPAG=B.PERPAG
			AND A.NROFOL=B.NROFOL
			AND A.RUTTRABAJ=B.RUTTRAB
			AND A.LICHASFEC=B.LICHASFEC
		) D
			ON C.FECPROCESO=D.PERPAG
			AND C.FOLIO=D.NROFOL
			AND C.RUTTRABAJ=D.RUTTRAB
			AND C.FECTERREPO=D.LICHASFEC
			WHERE C.FECPROCESO=$fecha$
			AND D.TIPOBS='1'
			ORDER BY C.FOLIO DESC
		) AS D ORDER BY D.FOLIO ASC
	</select>
	
	<!-- Insertar datos en tabla de ayuda para Log de Errores -->
	<insert id="insertAuxTable_LM">
		INSERT INTO LIEXP.ILFJAAUX ( NROFOL, RUTTRABAJ, PERPAG, LICHASFEC, TPOPROC, USUARIO)
			SELECT A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO , '2' TPOPROC, '$usuario$' USUARIO
				FROM LIEXP.ILFLM050 A
			INNER JOIN LIEXP.ILFLM054 B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO=B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
				AND B.TIPOBS='1'
				GROUP BY A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
				ORDER BY A.FOLIO
			FETCH FIRST $registrosPorPagina$ ROWS ONLY
		WITH NC
	</insert>
	
	<!-- Insertar la siguiente tanda de datos a procesar -->
	<insert id="insertAuxTable_LM_FW">
		INSERT INTO LIEXP.ILFJAAUX ( NROFOL, RUTTRABAJ, PERPAG, LICHASFEC, TPOPROC, USUARIO)
			SELECT A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO , '2' TPOPROC, '$usuario$' USUARIO
			FROM LIEXP.ILFLM050 A
			INNER JOIN LIEXP.ILFLM054 B
			ON A.FECPROCESO=B.PERPAG
			AND A.FOLIO=B.NROFOL
			AND A.RUTTRABAJ=B.RUTTRAB
			AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
			AND A.FOLIO &gt; '$ultimoNroFolio$'
			AND B.TIPOBS='1'
			GROUP BY A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
			ORDER BY A.FOLIO
			FETCH FIRST $registrosPorPagina$ ROWS ONLY
			WITH NC
	</insert>

	<!-- Insertar la anterior tanda de datos a procesar -->
	<insert id="insertAuxTable_LM_BK">
		INSERT INTO LIEXP.ILFJAAUX ( NROFOL, RUTTRABAJ, PERPAG, LICHASFEC, TPOPROC, USUARIO)
			SELECT C.* FROM ( 
			SELECT A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO , '2' TPOPROC, '$usuario$' USUARIO
			FROM LIEXP.ILFLM050 A
			INNER JOIN LIEXP.ILFLM054 B
			ON A.FECPROCESO=B.PERPAG
			AND A.FOLIO=B.NROFOL
			AND A.RUTTRABAJ=B.RUTTRAB
			AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
			AND A.FOLIO &lt; '$primerNroFolio$'
			AND B.TIPOBS='1'
			GROUP BY A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
			ORDER BY A.FOLIO DESC
			FETCH FIRST $registrosPorPagina$ ROWS ONLY) C
			ORDER BY C.FOLIO
			WITH NC
	</insert>
	
	<insert id="insertAuxTableUltima_LM">
		INSERT INTO LIEXP.ILFJAAUX ( NROFOL, RUTTRABAJ, PERPAG, LICHASFEC, TPOPROC, USUARIO)
			SELECT A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO , '2' TPOPROC, '$usuario$' USUARIO
				FROM LIEXP.ILFLM050 A
			INNER JOIN LIEXP.ILFLM054 B
				ON A.FECPROCESO=B.PERPAG
				AND A.FOLIO=B.NROFOL
				AND A.RUTTRABAJ=B.RUTTRAB
				AND A.FECTERREPO=B.LICHASFEC
			WHERE A.FECPROCESO=$fecha$
				AND B.TIPOBS='1'
				GROUP BY A.FOLIO, A.RUTTRABAJ, A.FECPROCESO, A.FECTERREPO
				ORDER BY A.FOLIO DESC
			FETCH FIRST $registrosPorPagina$ ROWS ONLY
		WITH NC
	</insert>
	
	<!-- Borrando de datos creados para proceso SIL -->
	<delete id="delILFJAAUX_LM" parameterClass="cl.laaraucana.silmsil.vo.ILFJAAUXVO">
		DELETE FROM LIEXP.ILFJAAUX WHERE TPOPROC='2' 
		AND PERPAG=#perpag# AND USUARIO=#usuario#
		WITH NC
	</delete>
</sqlMap>
